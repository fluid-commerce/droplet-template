import{d as e,c as t,D as n}from"./p-B7Yk6rNY.js";import{G as r,k as i}from"./p-C4wedjxV.js";import{o as a,D as o}from"./p-B2XW3qUq.js";import{S as l}from"./p-BG3D11hv.js";import{P as s,G as u,O as c,R as d}from"./p-D9lurr2W.js";import{D as h}from"./p-BpMJ0iVV.js";import{s as m}from"./p-Zw0IdN8R.js";import{c as p}from"./p-BvW5kj19.js";import"./p-DgA2OfDc.js";import"./p-CBK12GNN.js";var f=Object.defineProperty,y=e=>{throw TypeError(e)},g=(e,t,n)=>t in e?f(e,t,{enumerable:true,configurable:true,writable:true,value:n}):e[t]=n,b=(e,t,n)=>g(e,typeof t!="symbol"?t+"":t,n),w=(e,t,n)=>t.has(e)||y("Cannot "+n),v=(e,t,n)=>(w(e,t,"read from private field"),n?n.call(e):t.get(e)),C=(e,t,n)=>t.has(e)?y("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),D=(e,t,n,r)=>(w(e,t,"write to private field"),t.set(e,n),n),k=(e=>(e.NUMERIC_VALUES_ONLY="Numeric Value Only",e.VALUE_BARS="Value Bars",e.HEATMAP="Heat Map",e))(k||{}),S=(e=>(e.DIMENSION="dimension",e.MEASURE="measure",e.ROW_HEADER_GROUP="row-header-group",e.ROW_HEADER="row-header",e))(S||{});function W({columns:e,fontSize:t="16px",minColumnWidth:n,minHeaderColumnWidth:r,enableSorting:o=true,sortCriteria:s,onSortingChange:d}){const h=i();t=h.font.size;const p=(e,i)=>{var h,p,f,y,g,b;const w=e.type===S.ROW_HEADER||e.type===S.ROW_HEADER_GROUP,v=e.type!==S.DIMENSION||((h=e.children)==null?void 0:h.filter((e=>e.type===S.MEASURE)).length)===1,C=e.getLeafColumns(),D=w||C.some((e=>e.type===S.ROW_HEADER||e.type===S.ROW_HEADER_GROUP)),k=e.depth===0||e.type!==S.MEASURE||((y=(f=(p=e.parent)==null?void 0:p.children)==null?void 0:f.at(-1))==null?void 0:y.key)===e.key,W=o&&e.type!==S.DIMENSION,V=(g=s==null?void 0:s.find((t=>t.key===e.key)))==null?void 0:g.direction;return l.jsx("th",{colSpan:C.length,className:m("p-2 border-y first:border-l",{"border-b-0":(b=e.children)==null?void 0:b.length,"border-r":k,"lg:sticky lg:left-0 lg:z-10 bg-[color:--embeddable-controls-backgrounds-colors-soft]":D,"cursor-pointer":W}),style:n?{minWidth:(w?r:n)??"auto"}:{},...W?{onClick:()=>{d==null||d(e.key,V===a.DESCENDING?a.ASCENDING:a.DESCENDING)}}:null,children:l.jsxs("div",{className:m("text-center",{"text-left":v,"flex justify-between items-center gap-2":W}),children:[l.jsx("span",{className:"text-[color:--embeddable-font-colorNormal}]",style:{fontSize:t},children:e.label}),W?l.jsx("span",{className:m("w-3",{invisible:!V}),children:V===a.ASCENDING?l.jsx(u,{fill:"currentcolor"}):l.jsx(c,{fill:"currentcolor"})}):null]})},`${i}-${e.key}`)};return e.length?l.jsxs(l.Fragment,{children:[l.jsx("tr",{children:e.map(p)}),e[0].children?l.jsx(W,{columns:e.map((e=>(e==null?void 0:e.children)||[])).flat(),onSortingChange:d,fontSize:t,minColumnWidth:n,minHeaderColumnWidth:r,enableSorting:o,sortCriteria:s}):null]}):null}function V({isHeader:e,className:t,children:n}){const r=e?"th":"td";return l.jsx(r,{className:m("px-2 py-1.5 font-normal first:border-l bg-inherit",{"lg:z-10 lg:sticky lg:left-0 text-left":e},t),children:n})}const x=({columns:e,row:t,renderCell:n,level:r=0,isRowGroupDefaultExpanded:i})=>{var a;const[o,s]=h.useState(i??true),u=()=>{s((e=>!e))},c=(e,i)=>{var a,s,c,h;const p=e.type===S.ROW_HEADER;return l.jsx(V,{isHeader:p,className:m("border-b",{"border-r":!e.parent||((c=(s=(a=e.parent)==null?void 0:a.children)==null?void 0:s.at(-1))==null?void 0:c.key)===e.key||p}),children:l.jsxs("div",{className:"flex items-center",style:{marginLeft:p?`${r*30}px`:0},children:[(h=t.children)!=null&&h.length&&p?l.jsx(d,{className:m("w-4 h-4 mr-1 cursor-pointer transform",{"-rotate-90":!o}),onClick:u}):null,(n==null?void 0:n(i,e))||i[e.key]]})},`${t.id}-${e.key}`)},p=(e,t)=>e.map((e=>{var n;return e.type===S.ROW_HEADER_GROUP&&(n=e.group)!=null&&n.length?c(e.group[r],t):c(e,t)}));return l.jsxs(l.Fragment,{children:[l.jsx("tr",{className:`\n        bg-[color:--embeddable-controls-backgrounds-colors-soft]\n        hover:bg-[color:--embeddable-controls-backgrounds-colors-normal]`,children:p(e,t.data)}),o&&((a=t.children)==null?void 0:a.map((t=>l.jsx(x,{columns:e,row:t,renderCell:n,level:r+1},t.id))))]})},N="--\x3e",M=e=>e==null?"":e.toString().replaceAll(" ","_").toLowerCase(),R=e=>[...e.map((e=>M(e)))].join(N),j=[];for(let e=0;e<256;++e)j.push((e+256).toString(16).slice(1));function z(e,t=0){return(j[e[t+0]]+j[e[t+1]]+j[e[t+2]]+j[e[t+3]]+"-"+j[e[t+4]]+j[e[t+5]]+"-"+j[e[t+6]]+j[e[t+7]]+"-"+j[e[t+8]]+j[e[t+9]]+"-"+j[e[t+10]]+j[e[t+11]]+j[e[t+12]]+j[e[t+13]]+j[e[t+14]]+j[e[t+15]]).toLowerCase()}let T;const G=new Uint8Array(16);function $(){if(!T){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");T=crypto.getRandomValues.bind(crypto)}return T(G)}const E=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),B={randomUUID:E};function L(e,t,n){var r;if(B.randomUUID&&!e)return B.randomUUID();e=e||{};const i=e.random??((r=e.rng)==null?void 0:r.call(e))??$();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,z(i)}var H,F,I,_;class A{constructor(e,t=[],n=0){C(this,H),C(this,F),C(this,I),C(this,_),D(this,H,L()),D(this,F,e),D(this,I,t),D(this,_,n)}get id(){return v(this,H)}get data(){return v(this,F)}set data(e){D(this,F,e)}get children(){return v(this,I)}set children(e){D(this,I,e)}get depth(){return v(this,_)}getLeafRows(){return this.children.length?this.children.reduce(((e,t)=>[...e,...t.getLeafRows()]),[]):[this]}}H=new WeakMap,F=new WeakMap,I=new WeakMap,_=new WeakMap;var O,U,P,q,Y,J,K,X,Z,Q,ee,te;class ne{constructor(e,t,n=[],r=[],i=true){C(this,O),C(this,U),C(this,P),C(this,q),C(this,Y),C(this,J),C(this,K),C(this,X,{}),C(this,Z,((e,t)=>t==null?void 0:t.map((t=>(v(this,X)[t.name]||(v(this,X)[t.name]=new Set),v(this,X)[t.name].add(e[t.name]),e[t.name]))))),C(this,Q,(e=>v(this,U).reduce(((t,n)=>({...t,[R([...v(this,Z).call(this,e,v(this,q)),n.name])]:e[n.name]})),{}))),C(this,ee,((e,t,n)=>{if(!t.length){e.data={...e.data,...n};return}const r=M(t[0]);e.children.has(r)||e.children.set(r,{data:{},children:new Map}),v(this,ee).call(this,e.children.get(r),t.slice(1),n)})),C(this,te,((e,t=0)=>{const n=[];if(v(this,P).length)for(const[,r]of e.children)n.push(new A(r.data,v(this,te).call(this,r,t+1),t));else n.push(new A(e.data));return n})),D(this,O,e),D(this,U,t),D(this,P,n||[]),D(this,q,r),D(this,J,i),D(this,Y,v(this,O).reduce(((e,t,n)=>{const r=v(this,J)?v(this,P).slice(0,n+1):v(this,P);return t.forEach((t=>{const n=v(this,Z).call(this,t,r),i={...v(this,Q).call(this,t),...r.reduce(((e,n)=>({...e,[n.name]:t[n.name]})),{})};r.length&&v(this,P).length>1&&(i["__group.key"]=t[r.at(-1).name]),v(this,ee).call(this,e,n,i)})),e}),{data:{},children:new Map})),!v(this,P).length&&v(this,q).length&&v(this,O).forEach((e=>{e.forEach((e=>v(this,Z).call(this,e,v(this,q))))})),D(this,K,null)}get rows(){return v(this,K)||D(this,K,v(this,te).call(this,v(this,Y))),v(this,K)}getColumnDimensionValues(e){return[...v(this,X)[e]]}}O=new WeakMap,U=new WeakMap,P=new WeakMap,q=new WeakMap,Y=new WeakMap,J=new WeakMap,K=new WeakMap,X=new WeakMap,Z=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap;class re{constructor({label:e,key:t,type:n,dataType:r,depth:i=0,children:a,parent:o,group:l}){b(this,"label"),b(this,"key"),b(this,"type"),b(this,"dataType"),b(this,"depth"),b(this,"children"),b(this,"parent"),b(this,"group"),this.label=e,this.key=t,this.type=n,this.dataType=r??null,this.depth=i,this.parent=o??null,this.children=a??null,this.group=l??null}addChildren(e){return this.children=[...this.children||[],...e],this.children}getLeafColumns(){var e;return(e=this.children)!=null&&e.length?this.children.reduce(((e,t)=>[...e,...t.getLeafColumns()]),[]):[this]}}const ie=(e,t,n,r,a={})=>{const o=i();function l(n=false,r=null){const i=t.map((t=>new re({label:t.title,key:t.name,depth:e.length,type:S.ROW_HEADER,dataType:t.nativeType,parent:r})));return n?[new re({label:t.map((e=>e.title)).join(" → "),key:"__group.key",depth:e.length,type:S.ROW_HEADER_GROUP,group:i,parent:r})]:i}function s(e,n=0,r=null){if(!e.length)return l(a.aggregateRowDimensions&&t.length>1,r);const[i,...o]=e,u=new re({label:i.title,key:i.name,depth:n,type:S.DIMENSION,dataType:i.nativeType,parent:r}),c=s(o,n+1,u);return u.addChildren(c),[u]}function u(e,t=0,i=null,l=[]){if(!e.length)return n.map((e=>new re({label:e.title,key:R([...l,e.name]),depth:t,type:S.MEASURE,dataType:e.nativeType,parent:i||null})));const[s,...c]=e;return r[s.name].map((e=>{const n=new re({label:p(e,{...a.granularity&&s.nativeType==="time"&&e?{dateFormat:o.dateFormats[a.granularity]}:{}})??"-",key:R([...l,e]),depth:t,type:S.DIMENSION,dataType:s.nativeType,parent:i}),r=u(c,t+1,n,[...l,e]);return n.addChildren(r),n}))}const c=h.useMemo((()=>[...t.length?s(e):[],...u(e)]),[e,t,n,r,a.aggregateRowDimensions]),d=h.useMemo((()=>c.map((e=>e.getLeafColumns())).flat()),[c]);return{columns:c,getLeafColumns:()=>d}};function ae(e,t){return typeof t=="function"?t(e):e[t]}function oe(e){return!isNaN(e)}const le=e=>(t,n)=>{for(const{key:r,direction:i}of e){const e=ae(t,r)||0,a=ae(n,r)||0,o=se(e,a,i);if(o!==0)return o}return 0},se=(e,t,n)=>{if(oe(e)&&oe(t)){const r=parseInt(e,10),i=parseInt(t,10);return(r-i)*(n===a.ASCENDING?1:-1)}else return typeof e=="string"&&typeof t=="string"?e.localeCompare(t,void 0,{sensitivity:"base",numeric:true})*(n===a.ASCENDING?1:-1):typeof e=="number"?-1:1},ue=(e,t,n=[],r=[],i={})=>{const o=h.useMemo((()=>new ne(e,t,n,r,i.aggregateRowDimensions)),[e,t,n,r,i.aggregateRowDimensions]),l=h.useMemo((()=>r.reduce(((e,t)=>({...e,[t.name]:o.getColumnDimensionValues(t.name).sort(((e,t)=>se(e,t,i.defaultColumnsSort??a.ASCENDING)))})),{})),[r,o,i.defaultColumnsSort]),{columns:s,getLeafColumns:u}=ie(r,n,t,l,{aggregateRowDimensions:i.aggregateRowDimensions,granularity:i.granularity});return{rows:o.rows,columns:s,getLeafColumns:u}},ce=({aggregateRowDimensions:e=true,columnDimensions:t,columnSortingEnabled:n=true,data:r,defaultColumnDimensionSortDirection:a,defaultRowDimensionSortDirection:o,fontSize:s="14px",granularity:u,isRowGroupDefaultExpanded:c=true,measures:d,minColumnWidth:m,minRowDimensionColumnWidth:f,nullValueCharacter:y="",rowDimensions:g})=>{const b=i();s=b.font.size;const[w,v]=h.useState((()=>!g||!o?[]:[{key:g.length===1?g[0].name:"__group.key",direction:o}])),{rows:C,columns:D,getLeafColumns:k}=ue(r,d,g,t,{aggregateRowDimensions:e,defaultColumnsSort:a,granularity:u}),S=(e,t)=>{const n=[...e];return n.sort(le(t)),n.forEach((e=>{var n;(n=e.children)!=null&&n.length&&(e.children=S(e.children,t))})),n},V=h.useMemo((()=>{const e=parseInt(y,10);return w.map((t=>({...t,key:n=>n.data[t.key]||(isNaN(e)?null:e)})))}),[w]),N=h.useMemo((()=>S(C,V)),[C,V]),M=h.useMemo((()=>e=>d.find((t=>t.title===e))),[d]);return l.jsxs("table",{className:"min-w-full border-separate border-spacing-0 table-fixed",children:[l.jsx("thead",{className:`\n        embeddable-table-header\n        sticky\n        top-0\n        z-20\n        bg-[color:--embeddable-controls-backgrounds-colors-soft]\n      `,children:l.jsx(W,{columns:D,minColumnWidth:`${m}px`,minHeaderColumnWidth:`${f}px`,enableSorting:n,sortCriteria:w,onSortingChange:(e,t)=>{v([{key:e,direction:t}])},fontSize:s})}),l.jsx("tbody",{className:"overflow-y-auto",children:N.map((e=>l.jsx(x,{columns:k(),row:e,isRowGroupDefaultExpanded:c,renderCell:(e,t)=>{var n;const r=e[t.key];return typeof r=="boolean"?l.jsx("span",{style:{fontSize:s},children:r?"True":"False"}):l.jsx("span",{style:{fontSize:s},children:r==null?y:p(r,{...u&&t.dataType==="time"?{dateFormat:b.dateFormats[u]}:{},...M(t.label)?{meta:(n=M(t.label))==null?void 0:n.meta,type:"number"}:{}})})}},e.id)))})]})},de=({rowValues:t,columnValues:n,metrics:r,...i})=>{const a=[];return t!=null&&t.length&&i.aggregateRowDimensions?t==null||t.forEach(((e,t)=>{i[`resultsDimension${t}`]&&a.push(i[`resultsDimension${t}`])})):a.push(i.resultsDimension0),l.jsx(s,{title:i.title,results:a,description:i.description,className:"overflow-auto",children:a.every((e=>e&&!e.isLoading&&!e.error))&&l.jsx(ce,{...i,data:a.map((e=>e.data)),columnDimensions:n,defaultColumnDimensionSortDirection:i.columnSortDirection,rowDimensions:t==null?void 0:t.filter((t=>e(t))),defaultRowDimensionSortDirection:i.rowSortDirection,measures:r,fontSize:i.fontSize?`${i.fontSize}px`:void 0})})},he={name:"PivotTable",label:"Pivot table",classNames:["inside-card"],category:"Charts: essentials",inputs:[{name:"ds",type:"dataset",label:"Dataset to display",category:"Chart data"},{name:"metrics",type:"measure",label:"Metrics",array:true,config:{dataset:"ds"},category:"Chart data"},{name:"rowValues",type:"dimension",label:"Row Values",array:true,config:{dataset:"ds",hideGranularity:true},category:"Chart data"},{name:"columnValues",type:"dimension",label:"Column Values",array:true,config:{dataset:"ds",hideGranularity:true},category:"Chart data"},{name:"granularity",type:"granularity",label:"Granularity (for dates)",defaultValue:"week",category:"Variables to configure"},{name:"title",type:"string",label:"Title",description:"The title for the chart",category:"Chart settings"},{name:"description",type:"string",label:"Description",description:"The description for the chart",category:"Chart settings"},{name:"nullValueCharacter",type:"string",label:"Null value character",description:"Character that should be displayed if value does not exist",defaultValue:"∅",category:"Chart settings"},{name:"isRowGroupDefaultExpanded",type:"boolean",label:"Row group expanded by default",defaultValue:false,category:"Chart settings"},{name:"columnSortingEnabled",type:"boolean",label:"Enable column sorting",defaultValue:true,category:"Chart settings"},{name:"rowSortDirection",type:o,defaultValue:{value:a.ASCENDING},label:"Default Row Sort Direction",category:"Chart settings"},{name:"columnSortDirection",type:o,defaultValue:{value:a.ASCENDING},label:"Default Column Sort Direction",category:"Chart settings"},{name:"minColumnWidth",type:"number",label:"Minimum metric column width in pixels",defaultValue:150,category:"Chart styling"},{name:"minRowDimensionColumnWidth",type:"number",label:"Minimum row value width in pixels",defaultValue:200,category:"Chart styling"},{name:"fontSize",type:"number",label:"Font size in pixels",category:"Chart styling"}]},me=true,pe=r(de,he,{props:(r,[i])=>{var o,l,s;const u=Array.isArray(r.rowValues)?r.rowValues:[r.rowValues],c=Array.isArray(r.columnValues)?r.columnValues:[r.columnValues],d=(u||[]).filter((t=>e(t))),h=(c||[]).filter((t=>e(t))),m=(o=r.metrics)==null?void 0:o.filter((e=>t(e))),p=d.filter((t=>t&&e(t))),f=p.map((e=>{var t;return{property:e,direction:((t=r.rowSortDirection)==null?void 0:t.value)===a.ASCENDING?"asc":"desc"}})),y=d!=null&&d.length&&me?d.reduce(((e,t,i,a)=>{const o=[...p.slice(0,i+1),...h];return{...e,[`resultsDimension${i}`]:n({from:r.ds,select:[...o.filter((e=>e.nativeType!=="time")),...o.filter((e=>e.nativeType==="time")).map((e=>({dimension:e.name,granularity:r.granularity}))),...m],orderBy:f.slice(0,i+1),limit:1e4})}}),{}):{resultsDimension0:n({from:r.ds,select:[{...[...p||[],...h].filter((e=>e.nativeType==="time")).map((e=>({dimension:e.name,granularity:r.granularity})))},...m],limit:1e4})};return{...r,rowValues:u,columnValues:h,rowSortDirection:(l=r.rowSortDirection)==null?void 0:l.value,columnSortDirection:(s=r.columnSortDirection)==null?void 0:s.value,measureVisualizationFormat:k.NUMERIC_VALUES_ONLY,aggregateRowDimensions:me,fontSize:r.fontSize,...y}}});export{pe as default,he as meta};
//# sourceMappingURL=p-BOy3ERKv.js.map